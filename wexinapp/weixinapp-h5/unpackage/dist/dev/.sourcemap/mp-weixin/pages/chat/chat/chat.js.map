{"version":3,"sources":["uni-app:///main.js",null,"webpack:///E:/program/uni-app/weixinapp-h5/pages/chat/chat/chat.vue?f6f6","webpack:///E:/program/uni-app/weixinapp-h5/pages/chat/chat/chat.vue?203a","webpack:///E:/program/uni-app/weixinapp-h5/pages/chat/chat/chat.vue?0c07","uni-app:///pages/chat/chat/chat.vue"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page"],"mappings":";;;;;;;;;;kDAAA;;;AAGA;AACA,8F,8FAHA;AACAA,EAAE,CAACC,iCAAH,GAAuCC,mBAAvC,CAGAC,UAAU,CAACC,aAAD,CAAV,C;;;;;;;;;;;;;ACLA;AAAA;AAAA;AAAA;AAAA;AAAiH;AACjH;AACwD;AACL;;;AAGnD;AAC8K;AAC9K,gBAAgB,kLAAU;AAC1B,EAAE,0EAAM;AACR,EAAE,+EAAM;AACR,EAAE,wFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,mFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACbA;AAAA;AAAA;AAAA;AAAwpB,CAAgB,uoBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACyI5qB;;;;;;AAMA;AACA,mG;;;;;;AAMA;AACA;AACA,0BADA;AAEA,kCAFA;AAGA,8BAHA;AAIA,wBAJA;AAKA,kCALA,EADA;;AAQA,MARA,kBAQA;AACA;AACA,wBADA;AAEA;AACA,kBAHA;AAIA;AACA;AACA,kBADA;AAEA,8CAFA;AAGA,4BAHA;AAIA;AACA,kBADA;AAEA,gDAFA;AAGA,4BAHA,EAJA;AAQA;AACA,kBADA;AAEA,kDAFA;AAGA,yBAHA,EARA;AAYA;AACA,kBADA;AAEA,8CAFA;AAGA,yBAHA,EAZA;AAgBA;AACA,oBADA;AAEA,gDAFA;AAGA,iBAHA,EAhBA;AAoBA;AACA,kBADA;AAEA,+CAFA;AAGA,iBAHA,EApBA,CADA,CAJA;;;AA+BA,sBA/BA;AAgCA,cAhCA;AAiCA,uBAjCA;AAkCA,qBAlCA;AAmCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA9KA,OAnCA;AAmNA;AACA;AACA,kBADA;AAEA,iBAFA,EADA;;AAKA;AACA,qBADA;AAEA,iBAFA,EALA;;AASA;AACA,kBADA;AAEA,iBAFA,EATA;;AAaA;AACA,kBADA;AAEA,iBAFA,EAbA;;AAiBA;AACA,kBADA;AAEA,iBAFA,EAjBA;;AAqBA;AACA,kBADA;AAEA,+BAFA,EArBA,CAnNA;;;AA6OA,mBA7OA;AA8OA,2BA9OA;AA+OA,wBA/OA;AAgPA,wBAhPA;AAiPA,qBAjPA;AAkPA;AACA,aADA;AAEA,gBAFA;AAGA,kBAHA;AAIA,yBAJA,EAlPA;;;AAyPA,GAlQA;AAmQA,QAnQA,kBAmQA,CAnQA,EAmQA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wEADA,EACA;AACA;AACA;AACA;AACA,KANA;AAOA,GApRA;AAqRA,WArRA,uBAqRA;AACA;AACA;AACA;AACA,GAzRA;AA0RA,SA1RA,qBA0RA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KATA;;AAWA;AACA;AACA;AACA;AACA,iCADA;;AAGA;AACA,KANA;AAOA,GAnTA;AAoTA;AACA;AACA,oEADA;AAEA,+DAFA;AAGA,2EAHA;AAIA,wDAJA;AAKA,sFALA,GADA;;AAQA;AACA,mBATA,6BASA;AACA;AACA;AACA;AACA;AACA;AACA,KAfA;AAgBA;AACA,kBAjBA,4BAiBA;AACA;AACA;AACA,KApBA;AAqBA,iBArBA,2BAqBA;AACA;AACA,KAvBA;AAwBA;AACA,YAzBA,sBAyBA;AACA;AACA;;AAEA;AACA,KA9BA;AA+BA;AACA,aAhCA,uBAgCA;AACA;AACA;AACA;AACA;AACA;AACA,OALA;AAMA,KAvCA;AAwCA;AACA,kBAzCA,4BAyCA;AACA;AACA,KA3CA;AA4CA;AACA,wBA7CA,kCA6CA;AACA;AACA,KA/CA;AAgDA;AACA,cAjDA,wBAiDA;AACA;AACA,KAnDA;AAoDA;AACA,aArDA,uBAqDA;AACA;AACA;AACA;AACA;AACA;AACA,OAJA;AAKA;AACA,KA7DA,GApTA;;AAmXA;AACA,QADA,gBACA,MADA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KARA,EAnXA;;AA6XA;AACA;AACA,qBADA,EADA;;AAIA,QAJA,kBAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,2BADA;AAEA,kDAFA;AAGA,iCAHA;;AAKA;AACA;;AAEA;AACA,KAxBA;AAyBA,eAzBA,yBAyBA;AACA;AACA;AACA,4BADA;AAEA,0CAFA,GADA;;;AAMA,KAhCA;AAiCA,aAjCA,uBAiCA;AACA;AACA,KAnCA;AAoCA,cApCA,wBAoCA;AACA;AACA,KAtCA;AAuCA,gBAvCA,0BAuCA;AACA;;AAEA;AACA;AACA,OAFA,EAEA,EAFA;AAGA,KA7CA;AA8CA;AACA,wBA/CA,kCA+CA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAtDA;AAuDA;AACA,gBAxDA,0BAwDA;;;;;;;;;;;AAWA;AACA;AACA;AACA,OAHA,EAGA,GAHA;;AAKA,KAxEA;AAyEA;AACA,QA1EA,sBA0EA;AACA;AACA;AACA,KA7EA;AA8EA,cA9EA,sBA8EA,KA9EA,EA8EA;AACA;AACA;AACA;AACA;AACA;AACA,gBALA;;AAOA;AACA,KAvFA;AAwFA,QAxFA,gBAwFA,IAxFA,EAwFA;AACA;AACA;AACA;AACA;AACA,gBAHA;;AAKA;AACA,kBADA;AAEA,kBAFA;AAGA,wBAHA;;;AAMA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAFA;AAGA;;AAEA;AACA;AACA;AACA;AACA,OAHA,EAGA,KAHA,CAGA;AACA;AACA;AACA,OANA;;AAQA;AACA;AACA;;AAEA;AACA,KA/HA;AAgIA;AACA,eAjIA,uBAiIA,CAjIA,EAiIA;AACA;AACA;AACA;;AAEA;AACA;AACA,oBADA;AAEA;AACA;AACA;AACA,eAFA;AAGA,aANA;;AAQA;AACA;AACA;AACA;AACA;AACA;AACA,2BADA;AAEA;AACA;AACA;AACA;AACA,0BADA;;AAGA;AACA,aATA;;AAWA,gBA7BA;;AA+BA,KAjKA;AAkKA,gBAlKA,wBAkKA,GAlKA,EAkKA;AACA;AACA,oBADA;AAEA,4BAFA;AAGA,4BAHA;;AAKA,KAxKA;AAyKA,qBAzKA,+BAyKA;AACA;AACA,KA3KA;AA4KA,mBA5KA,2BA4KA,CA5KA,EA4KA;AACA;AACA;AACA;;AAEA;AACA;AACA,qBADA;;AAGA,KArLA;AAsLA,kBAtLA,0BAsLA,CAtLA,EAsLA;AACA;AACA;AACA,KAzLA;AA0LA,iBA1LA,2BA0LA;AACA;;AAEA;AACA;AACA,KA/LA;AAgMA,oBAhMA,8BAgMA;AACA;AACA;;AAEA;AACA;AACA,KAtMA,GA7XA,E","file":"pages/chat/chat/chat.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/chat/chat/chat.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./chat.vue?vue&type=template&id=b179d31e&\"\nvar renderjs\nimport script from \"./chat.vue?vue&type=script&lang=js&\"\nexport * from \"./chat.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../soft/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/chat/chat/chat.vue\"\nexport default component.exports","export * from \"-!../../../../../../soft/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../soft/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../soft/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../soft/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../soft/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../soft/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=template&id=b179d31e&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  if (!_vm._isMounted) {\n    _vm.e0 = function($event) {\n      _vm.keyboardHeight = 0\n    }\n  }\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../soft/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../soft/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../soft/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../soft/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../soft/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../soft/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../soft/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../soft/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../soft/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../soft/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=script&lang=js&\"","<template>\n\t<view>\n\t\t<freeNavBar :title='detail.name' :noreadnum=\"totalNoreadnum\" showBack>\r\n\t\t\t<freeIconButton slot='right' :icon=\"'\\ue6fd'\" @click=\"openChatSet\">\r\n\t\t\t</freeIconButton>\r\n\t\t</freeNavBar>\r\n\t\t\r\n\t\t\r\n\t\t<!-- 聊天内容区域 -->\r\n\t\t<scroll-view \r\n\t\t\tscroll-y \r\n\t\t\tclass=\"bg-light position-fixed left-0 right-0 px-3\" \r\n\t\t\tstyle=\"box-sizing: border-box;\"\r\n\t\t\t:style=\"chatBodyBottom\"\r\n\t\t\t:show-scrollbar=\"false\"\r\n\t\t\t@click=\"clickPage\"\r\n\t\t\t:scroll-into-view=\"scrollIntoView\"\r\n\t\t\tscroll-with-animation\r\n\t\t>\r\n\t\t\t<!-- 聊天信息列表组件 -->\r\n\t\t\t<view v-for=\"(item, index) in list\" :key=\"index\" :id=\"'chatItem_' + index\">\r\n\t\t\t\t<freeChatItem \r\n\t\t\t\t\tref=\"chatItem\"\r\n\t\t\t\t\t:item=\"item\" \r\n\t\t\t\t\t:index=\"index\" \r\n\t\t\t\t\t:pretime='index > 0 ? list[index-1].create_time : 0' \r\n\t\t\t\t\t@long='long'\r\n\t\t\t\t\t@preview='previewImage'\r\n\t\t\t\t\t:shownickname=\"currentChatItem.shownickname\"\r\n\t\t\t\t/>\r\n\t\t\t</view>\r\n\t\t</scroll-view>\r\n\t\t\r\n\t\t<!-- #ifdef APP-PLUS-NVUE -->\r\n\t\t<view \r\n\t\t\tv-if=\"mode == 'action' || mode == 'emoticon'\"\r\n\t\t\t@click=\"clickPage\" \r\n\t\t\tclass=\"position-fixed left-0 right-0 top-0\" \r\n\t\t\t:style=\"'bottom:' + maskBottom + 'px'\"\r\n\t\t>\r\n\t\t</view>\r\n\t\t<!-- #endif -->\r\n\t\t\r\n\t\t<!-- 底部输入框 -->\r\n\t\t<view \r\n\t\t\tclass=\"position-fixed left-0 right-0 border-top flex align-center\" \r\n\t\t\tstyle=\"background-color: #f7f7f6;height: 105rpx;\"\r\n\t\t\t:style=\"'bottom:' + keyboardHeight + 'px'\"\r\n\t\t>\r\n\t\t\t<freeIconButton v-if=\"mode == 'audio'\" @click=\"changeVoiceOrText\" :icon=\"'\\ue607'\">\r\n\t\t\t</freeIconButton>\r\n\t\t\t<freeIconButton v-else @click=\"changeVoiceOrText\" :icon=\"'\\ue606'\">\r\n\t\t\t</freeIconButton>\r\n\t\t\t\r\n\t\t\t<view class=\"flex-1\">\r\n\t\t\t\t<view \r\n\t\t\t\t\tv-if=\"mode == 'audio'\" \r\n\t\t\t\t\tstyle=\"height: 80rpx;\" \r\n\t\t\t\t\tclass=\"rounded flex align-center justify-center\"\r\n\t\t\t\t\t:class=\"isRecording ? 'bg-light':'bg-white'\"\r\n\t\t\t\t\t@touchstart=\"voiceTouchStart\"\r\n\t\t\t\t\t@touchmove=\"voiceTouchMove\"\r\n\t\t\t\t\t@touchend=\"voiceTouchEnd\"\r\n\t\t\t\t\t@touchcancel=\"voiceTouchCancel\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<text class=\"font\">{{isRecording ? '松开结束' : '按住 说话'}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<textarea \r\n\t\t\t\t\tv-else\r\n\t\t\t\t\tv-model=\"text\" \r\n\t\t\t\t\tfixed \r\n\t\t\t\t\tclass=\"bg-white rounded p-2 font-md\" \r\n\t\t\t\t\tstyle=\"height: 50rpx;max-width: 450rpx;\" \r\n\t\t\t\t\t:adjust-position=\"false\"\r\n\t\t\t\t\t@click=\"clickInput\"\r\n\t\t\t\t\t@focus=\"onInputFocus\"\r\n\t\t\t\t>\r\n\t\t\t\t</textarea>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<!-- 表情 -->\r\n\t\t\t<freeIconButton @click=\"openActionOrEmoticon('emoticon')\" :icon=\"'\\ue605'\">\r\n\t\t\t</freeIconButton>\r\n\t\t\t<!-- 扩展菜单 -->\r\n\t\t\t<freeIconButton @click=\"openActionOrEmoticon('action')\" v-if=\"text.length === 0\" :icon=\"'\\ue603'\">\r\n\t\t\t</freeIconButton>\r\n\t\t\t<!-- 发送按钮 -->\r\n\t\t\t<view v-else class=\"flex-shrink\">\r\n\t\t\t\t<freeMainButton name=\"发送\" @click=\"send('text')\"></freeMainButton>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 扩展菜单 -->\r\n\t\t<freePopup :mask='false' bottom ref=\"action\" transformOrigin=\"center bottom\" @hide='keyboardHeight = 0'>\r\n\t\t\t<view style=\"height: 580rpx;\" class=\"border-top border-light-secondary bg-light\">\r\n\t\t\t\t<swiper :indicator-dots=\"emoticonOrActionList.length > 1\" style=\"height: 510rpx;\">\r\n\t\t\t\t\t<swiper-item class=\"row\" v-for='(item,index) in emoticonOrActionList' :key=\"index\">\r\n\t\t\t\t\t\t<view \r\n\t\t\t\t\t\t\tclass=\"col-3 flex align-center justify-center flex-column\" \r\n\t\t\t\t\t\t\tstyle='height:225rpx'\r\n\t\t\t\t\t\t\tv-for='(item2,index2) in item' :key=\"index2\"\r\n\t\t\t\t\t\t\t@click=\"actionEvent(item2)\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<image :src='item2.icon' style=\"width: 100rpx;height: 100rpx;\"></image>\r\n\t\t\t\t\t\t\t<text class=\"font-sm text-muted mt-2\">{{item2.name}}</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</swiper-item>\r\n\t\t\t\t</swiper>\r\n\t\t\t</view>\r\n\t\t</freePopup>\r\n\t\t\r\n\t\t<!-- 点击消息弹出层 -->\r\n\t\t<freePopup ref=\"extend\" :bodyWidth=\"240\" :bodyHeight=\"getMenusHeight\" :tabbarHeight='105'>\r\n\t\t\t<view class=\"flex flex-column\" style=\"width: 240rpx;\" :style=\"getMenusStyle\">\r\n\t\t\t\t<view \r\n\t\t\t\t\tv-for=\"(item,index) in menusList\" \r\n\t\t\t\t\t:key=\"index\" \r\n\t\t\t\t\tclass=\"flex-1 flex align-center\" \r\n\t\t\t\t\thover-class=\"bg-hover-light\"\r\n\t\t\t\t\t@click=\"clickEvent(item.event)\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<text class=\"font-md pl-3\">{{item.name}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</freePopup>\r\n\t\t\r\n\t\t<!-- 录音提示 -->\r\n\t\t<view v-if=\"isRecording\" class=\"position-fixed left-0 right-0 top-0 flex align-center justify-center\" style=\"bottom: 105rpx\">\r\n\t\t\t<view style=\"width:360rpx;height:360rpx;background:rgba(0,0,0,0.5)\" class=\"rounded flex flex-column align-center justify-center\">\r\n\t\t\t\t<image src='/static/audio/recording.gif' style=\"width: 150rpx; height: 150rpx;\"></image>\r\n\t\t\t\t<text class=\"font text-white mt-3\">{{unRecord ? '松开手指，取消发送' : '手指上滑，取消发送'}}</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\n</template>\n\n<script>\r\n\timport {mapState,mapMutations} from 'vuex';\r\n\timport freeNavBar from '@/components/free-ui/free-nav-bar.vue'\r\n\timport freeIconButton from '@/components/free-ui/free-icon-button.vue'\r\n\timport freeChatItem from '@/components/free-ui/free-chat-item.vue'\r\n\timport freePopup from '@/components/free-ui/free-popup.vue'\r\n\timport freeMainButton from '@/components/free-ui/free-main-button.vue'\r\n\timport $U from '@/common/free-lib/util.js';\r\n\timport $H from '@/common/free-lib/request.js';\r\n\t\r\n\t// #ifdef APP-PLUS-NVUE\r\n\tconst dom = weex.requireModule('dom')\r\n\t// #endif\r\n\t\r\n\texport default {\r\n\t\tcomponents: {\r\n\t\t\tfreeNavBar,\r\n\t\t\tfreeIconButton,\r\n\t\t\tfreeChatItem,\r\n\t\t\tfreePopup,\r\n\t\t\tfreeMainButton\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tscrollIntoView: '',\r\n\t\t\t\t// text, emoticon, action, audio\r\n\t\t\t\tmode: 'text',\r\n\t\t\t\tactionList: [\r\n\t\t\t\t\t[{\r\n\t\t\t\t\t\tname:\"相册\",\r\n\t\t\t\t\t\ticon:\"/static/images/extends/pic.png\",\r\n\t\t\t\t\t\tevent:\"uploadImage\"\r\n\t\t\t\t\t},{\r\n\t\t\t\t\t\tname:\"拍摄\",\r\n\t\t\t\t\t\ticon:\"/static/images/extends/video.png\",\r\n\t\t\t\t\t\tevent:\"uploadVideo\"\r\n\t\t\t\t\t},{\r\n\t\t\t\t\t\tname:\"收藏\",\r\n\t\t\t\t\t\ticon:\"/static/images/extends/shoucan.png\",\r\n\t\t\t\t\t\tevent:\"openFava\"\r\n\t\t\t\t\t},{\r\n\t\t\t\t\t\tname:\"名片\",\r\n\t\t\t\t\t\ticon:\"/static/images/extends/man.png\",\r\n\t\t\t\t\t\tevent:\"sendCard\"\r\n\t\t\t\t\t},{\r\n\t\t\t\t\t\tname:\"语音通话\",\r\n\t\t\t\t\t\ticon:\"/static/images/extends/phone.png\",\r\n\t\t\t\t\t\tevent:\"\"\r\n\t\t\t\t\t},{\r\n\t\t\t\t\t\tname:\"位置\",\r\n\t\t\t\t\t\ticon:\"/static/images/extends/path.png\",\r\n\t\t\t\t\t\tevent:\"\"\r\n\t\t\t\t\t}]\r\n\t\t\t\t],\r\n\t\t\t\temoticonList: [],\r\n\t\t\t\ttext: '',\r\n\t\t\t\tkeyboardHeight: 0,\r\n\t\t\t\tnavBarHeight: 0,\r\n\t\t\t\tlist: [\r\n\t\t\t\t\t// {\r\n\t\t\t\t\t// \tavatar: '../../../static/video/demo.jpg',\r\n\t\t\t\t\t// \tuser_id:1,\r\n\t\t\t\t\t// \tnickname: '昵称',\r\n\t\t\t\t\t// \ttype:'text', // text,audio,video,image,emoticon,share\r\n\t\t\t\t\t// \tdata: '自己',\r\n\t\t\t\t\t// \tcreate_time: 1669813514530,\r\n\t\t\t\t\t// \tisremove:false\r\n\t\t\t\t\t// },\r\n\t\t\t\t\t// {\r\n\t\t\t\t\t// \tavatar: '../../../static/video/demo.jpg',\r\n\t\t\t\t\t// \tuser_id:2,\r\n\t\t\t\t\t// \tnickname: '昵称',\r\n\t\t\t\t\t// \ttype:'text',\r\n\t\t\t\t\t// \tdata: '别人',\r\n\t\t\t\t\t// \tcreate_time: 1669813514570,\r\n\t\t\t\t\t// \tisremove:false\r\n\t\t\t\t\t// },\r\n\t\t\t\t\t// {\r\n\t\t\t\t\t// \tavatar: '../../../static/video/demo.jpg',\r\n\t\t\t\t\t// \tuser_id:2,\r\n\t\t\t\t\t// \tnickname: '昵称',\r\n\t\t\t\t\t// \ttype:'text',\r\n\t\t\t\t\t// \tdata: '别人',\r\n\t\t\t\t\t// \tcreate_time: 1669813514670,\r\n\t\t\t\t\t// \tisremove:false\r\n\t\t\t\t\t// },\r\n\t\t\t\t\t// {\r\n\t\t\t\t\t// \tavatar: '../../../static/video/demo.jpg',\r\n\t\t\t\t\t// \tuser_id:2,\r\n\t\t\t\t\t// \tnickname: '昵称',\r\n\t\t\t\t\t// \ttype:'text',\r\n\t\t\t\t\t// \tdata: '别人',\r\n\t\t\t\t\t// \tcreate_time: 1669813514670,\r\n\t\t\t\t\t// \tisremove:false\r\n\t\t\t\t\t// },\r\n\t\t\t\t\t// {\r\n\t\t\t\t\t// \tavatar: '../../../static/video/demo.jpg',\r\n\t\t\t\t\t// \tuser_id:2,\r\n\t\t\t\t\t// \tnickname: '昵称',\r\n\t\t\t\t\t// \ttype:'text',\r\n\t\t\t\t\t// \tdata: '别人',\r\n\t\t\t\t\t// \tcreate_time: 1669813514670,\r\n\t\t\t\t\t// \tisremove:false\r\n\t\t\t\t\t// },\r\n\t\t\t\t\t// {\r\n\t\t\t\t\t// \tavatar: '../../../static/video/demo.jpg',\r\n\t\t\t\t\t// \tuser_id:2,\r\n\t\t\t\t\t// \tnickname: '昵称',\r\n\t\t\t\t\t// \ttype:'text',\r\n\t\t\t\t\t// \tdata: '别人',\r\n\t\t\t\t\t// \tcreate_time: 1669813514670,\r\n\t\t\t\t\t// \tisremove:false\r\n\t\t\t\t\t// },\r\n\t\t\t\t\t// {\r\n\t\t\t\t\t// \tavatar: '../../../static/video/demo.jpg',\r\n\t\t\t\t\t// \tuser_id:2,\r\n\t\t\t\t\t// \tnickname: '昵称',\r\n\t\t\t\t\t// \ttype:'text',\r\n\t\t\t\t\t// \tdata: '别人',\r\n\t\t\t\t\t// \tcreate_time: 1669813514670,\r\n\t\t\t\t\t// \tisremove:false\r\n\t\t\t\t\t// },\r\n\t\t\t\t\t// {\r\n\t\t\t\t\t// \tavatar: '../../../static/video/demo.jpg',\r\n\t\t\t\t\t// \tuser_id:2,\r\n\t\t\t\t\t// \tnickname: '昵称',\r\n\t\t\t\t\t// \ttype:'text',\r\n\t\t\t\t\t// \tdata: '别人',\r\n\t\t\t\t\t// \tcreate_time: 1669813514670,\r\n\t\t\t\t\t// \tisremove:false\r\n\t\t\t\t\t// },\r\n\t\t\t\t\t// {\r\n\t\t\t\t\t// \tavatar: '../../../static/video/demo.jpg',\r\n\t\t\t\t\t// \tuser_id:2,\r\n\t\t\t\t\t// \tnickname: '昵称',\r\n\t\t\t\t\t// \ttype:'text',\r\n\t\t\t\t\t// \tdata: '别人',\r\n\t\t\t\t\t// \tcreate_time: 1669813514670,\r\n\t\t\t\t\t// \tisremove:false\r\n\t\t\t\t\t// },\r\n\t\t\t\t\t// {\r\n\t\t\t\t\t// \tavatar: '../../../static/video/demo.jpg',\r\n\t\t\t\t\t// \tuser_id:2,\r\n\t\t\t\t\t// \tnickname: '昵称',\r\n\t\t\t\t\t// \ttype:'text',\r\n\t\t\t\t\t// \tdata: '别人',\r\n\t\t\t\t\t// \tcreate_time: 1669813514670,\r\n\t\t\t\t\t// \tisremove:false\r\n\t\t\t\t\t// },\r\n\t\t\t\t\t// {\r\n\t\t\t\t\t// \tavatar: '../../../static/video/demo.jpg',\r\n\t\t\t\t\t// \tuser_id:2,\r\n\t\t\t\t\t// \tnickname: '昵称',\r\n\t\t\t\t\t// \ttype:'text',\r\n\t\t\t\t\t// \tdata: '别人',\r\n\t\t\t\t\t// \tcreate_time: 1669813514670,\r\n\t\t\t\t\t// \tisremove:false\r\n\t\t\t\t\t// },\r\n\t\t\t\t\t// {\r\n\t\t\t\t\t// \tavatar: '../../../static/video/demo.jpg',\r\n\t\t\t\t\t// \tuser_id:2,\r\n\t\t\t\t\t// \tnickname: '昵称',\r\n\t\t\t\t\t// \ttype:'text',\r\n\t\t\t\t\t// \tdata: '别人',\r\n\t\t\t\t\t// \tcreate_time: 1669813514670,\r\n\t\t\t\t\t// \tisremove:false\r\n\t\t\t\t\t// },\r\n\t\t\t\t\t// {\r\n\t\t\t\t\t// \tavatar: '../../../static/video/demo.jpg',\r\n\t\t\t\t\t// \tuser_id:2,\r\n\t\t\t\t\t// \tnickname: '昵称',\r\n\t\t\t\t\t// \ttype:'text',\r\n\t\t\t\t\t// \tdata: '别人',\r\n\t\t\t\t\t// \tcreate_time: 1669813514670,\r\n\t\t\t\t\t// \tisremove:false\r\n\t\t\t\t\t// },\r\n\t\t\t\t\t// {\r\n\t\t\t\t\t// \tavatar: '../../../static/video/demo.jpg',\r\n\t\t\t\t\t// \tuser_id:2,\r\n\t\t\t\t\t// \tnickname: '昵称',\r\n\t\t\t\t\t// \ttype:'text',\r\n\t\t\t\t\t// \tdata: '别人',\r\n\t\t\t\t\t// \tcreate_time: 1669813514670,\r\n\t\t\t\t\t// \tisremove:false\r\n\t\t\t\t\t// },\r\n\t\t\t\t\t// {\r\n\t\t\t\t\t// \tavatar: '../../../static/video/demo.jpg',\r\n\t\t\t\t\t// \tuser_id:1,\r\n\t\t\t\t\t// \tnickname: '昵称',\r\n\t\t\t\t\t// \ttype:'audio',\r\n\t\t\t\t\t// \tdata: '/static/notice.mp3',\r\n\t\t\t\t\t// \toptions: {\r\n\t\t\t\t\t// \t\ttime: 10\r\n\t\t\t\t\t// \t},\r\n\t\t\t\t\t// \tcreate_time: 1669813514670,\r\n\t\t\t\t\t// \tisremove:false\r\n\t\t\t\t\t// },\r\n\t\t\t\t\t// {\r\n\t\t\t\t\t// \tavatar: '../../../static/video/demo.jpg',\r\n\t\t\t\t\t// \tuser_id:2,\r\n\t\t\t\t\t// \tnickname: '昵称',\r\n\t\t\t\t\t// \ttype:'audio',\r\n\t\t\t\t\t// \tdata: '/static/notice.mp3',\r\n\t\t\t\t\t// \toptions: {\r\n\t\t\t\t\t// \t\ttime: 20\r\n\t\t\t\t\t// \t},\r\n\t\t\t\t\t// \tcreate_time: 1669813514670,\r\n\t\t\t\t\t// \tisremove:false\r\n\t\t\t\t\t// },\r\n\t\t\t\t\t// {\r\n\t\t\t\t\t// \tavatar: '../../../static/video/demo.jpg',\r\n\t\t\t\t\t// \tuser_id:1,\r\n\t\t\t\t\t// \tnickname: '昵称',\r\n\t\t\t\t\t// \ttype:'audio',\r\n\t\t\t\t\t// \tdata: '/static/notice.mp3',\r\n\t\t\t\t\t// \toptions: {\r\n\t\t\t\t\t// \t\ttime: 30\r\n\t\t\t\t\t// \t},\r\n\t\t\t\t\t// \tcreate_time: 1669813514670,\r\n\t\t\t\t\t// \tisremove:false\r\n\t\t\t\t\t// },\r\n\t\t\t\t\t// {\r\n\t\t\t\t\t// \tavatar: '../../../static/video/demo.jpg',\r\n\t\t\t\t\t// \tuser_id:1,\r\n\t\t\t\t\t// \tnickname: '昵称',\r\n\t\t\t\t\t// \ttype:'video',\r\n\t\t\t\t\t// \tdata: '/static/video/demo.mp4',\r\n\t\t\t\t\t// \toptions:{\r\n\t\t\t\t\t// \t\tposter: '/static/video/demo.jpg',\r\n\t\t\t\t\t// \t},\r\n\t\t\t\t\t// \tcreate_time: 1669813514670,\r\n\t\t\t\t\t// \tisremove:false\r\n\t\t\t\t\t// },\r\n\t\t\t\t],\r\n\t\t\t\tmenus: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname:'复制',\r\n\t\t\t\t\t\tevent: ''\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname:'发送给朋友',\r\n\t\t\t\t\t\tevent: '',\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname:'收藏',\r\n\t\t\t\t\t\tevent: '',\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname:'删除',\r\n\t\t\t\t\t\tevent: '',\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname:'多选',\r\n\t\t\t\t\t\tevent: '',\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname:'撤回',\r\n\t\t\t\t\t\tevent: 'removeChatItem',\r\n\t\t\t\t\t}\r\n\t\t\t\t],\r\n\t\t\t\tpropIndex:-1,\r\n\t\t\t\tsavekeyboardHeight: 0,\r\n\t\t\t\tisRecording: false,\r\n\t\t\t\trecordingStartY: 0,\r\n\t\t\t\tunRecord: false,\r\n\t\t\t\tdetail: {\r\n\t\t\t\t\tid:0,\r\n\t\t\t\t\tname:'',\r\n\t\t\t\t\tavatar: '',\r\n\t\t\t\t\tchat_type: 'user'\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad(e) {\r\n\t\t\tthis.detail = JSON.parse(decodeURIComponent(e.params))\r\n\t\t\t\r\n\t\t\tthis.init()\r\n\t\t\t\r\n\t\t\t// 创建聊天对象\r\n\t\t\tthis.chat.createChatObject(this.detail)\r\n\t\t\t// 获取历史记录\r\n\t\t\tthis.list = this.chat.getChatDetail()\r\n\t\t\t// 监听接受聊天信息\r\n\t\t\tuni.$on('onMessage', (message) => {\r\n\t\t\t\tif((message.from_id === this.detail.id && message.chat_type === 'user') || (\r\n\t\t\t\tmessage.chat_type === 'group' && message.to_id === this.detail.id)){\r\n\t\t\t\t\tthis.list.push(message)\r\n\t\t\t\t\t// 至于底部\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tdestroyed() {\r\n\t\t\t// 销毁聊天对象\r\n\t\t\tthis.chat.destoryChatObject()\r\n\t\t\tuni.$off('onMessage', () => {})\r\n\t\t},\r\n\t\tmounted() {\r\n\t\t\tlet statusBarHeight = uni.getSystemInfoSync().statusBarHeight\r\n\t\t\tthis.navBarHeight = statusBarHeight + uni.upx2px(90)\r\n\t\t\t\r\n\t\t\tthis.pageToBottom()\r\n\t\t\t\r\n\t\t\tuni.onKeyboardHeightChange(res => {\t\t\t\t\r\n\t\t\t\tthis.savekeyboardHeight = res.height\r\n\t\t\t\tif(this.mode !== 'action' && this.mode !== 'emoticon'){\r\n\t\t\t\t\tthis.keyboardHeight = res.height\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(this.keyboardHeight > 0){\r\n\t\t\t\t\tthis.pageToBottom()\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t\r\n\t\t\t// 注册发送音频的事件\r\n\t\t\tthis.regSendVoiceEvent((url) => {\r\n\t\t\t\tif(!this.unRecord){\r\n\t\t\t\t\tthis.send('audio', url, {\r\n\t\t\t\t\t\ttime: this.recordTime\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tcomputed:{\r\n\t\t\t...mapState({\r\n\t\t\t\tchatList: state => state.user.chatList,\r\n\t\t\t\tRECORD: state => state.audio.RECORD,\r\n\t\t\t\trecordTime: state => state.audio.recordTime,\r\n\t\t\t\tchat: state => state.user.chat,\r\n\t\t\t\ttotalNoreadnum: state => state.user.totalNoreadnum\r\n\t\t\t}),\r\n\t\t\t// 当前会话配置信息\r\n\t\t\tcurrentChatItem(){\r\n\t\t\t\tlet index = this.chatList.findIndex(item=>item.id === this.detail.id && item.chat_type === this.detail.chat_type)\r\n\t\t\t\tif(index !== -1){\r\n\t\t\t\t\treturn this.chatList[index]\r\n\t\t\t\t}\r\n\t\t\t\treturn {}\r\n\t\t\t},\r\n\t\t\t// 动态获取菜单高度\r\n\t\t\tgetMenusHeight(){\r\n\t\t\t\tlet h = 100\r\n\t\t\t\treturn this.menus.length * h\r\n\t\t\t},\r\n\t\t\tgetMenusStyle(){\r\n\t\t\t\treturn `height:${this.getMenusHeight}rpx`\r\n\t\t\t},\r\n\t\t\t// 判断是否操作本人信息\r\n\t\t\tisdoself(){\r\n\t\t\t\tlet id = 1\r\n\t\t\t\tlet user_id = this.propIndex > -1 ? this.list[this.propIndex].user_id : 0\r\n\t\t\t\t\r\n\t\t\t\treturn user_id === id\r\n\t\t\t},\r\n\t\t\t// 获取操作菜单\r\n\t\t\tmenusList(){\r\n\t\t\t\treturn this.menus.filter(v => {\r\n\t\t\t\t\tif(v.name === '撤回' && !this.isdoself){\r\n\t\t\t\t\t\treturn false\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 聊天区域bottom\r\n\t\t\tchatBodyBottom(){\r\n\t\t\t\treturn `bottom:${uni.upx2px(105) + this.keyboardHeight}px;top:${this.navBarHeight}px`\r\n\t\t\t},\r\n\t\t\t// 获取操作或表情列表\r\n\t\t\temoticonOrActionList(){\r\n\t\t\t\treturn (this.mode === 'emoticon' || this.mode === 'action') ? this[this.mode+'List'] : []\r\n\t\t\t},\r\n\t\t\t// 获取蒙版的位置\r\n\t\t\tmaskBottom(){\r\n\t\t\t\treturn this.keyboardHeight + uni.upx2px(105)\r\n\t\t\t},\r\n\t\t\t// 所有信息的图片地址\r\n\t\t\timageList(){\r\n\t\t\t\tlet arr = []\r\n\t\t\t\tthis.list.forEach(item => {\r\n\t\t\t\t\tif(item.type == 'emoticon' || item.type == 'image'){\r\n\t\t\t\t\t\tarr.push(item.data)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\treturn arr\r\n\t\t\t}\r\n\t\t},\r\n\t\twatch:{ \r\n\t\t\tmode(newVal){\r\n\t\t\t\tif(newVal !== 'action' && newVal !== 'emoticon'){\r\n\t\t\t\t\tthis.$refs.action.hide()\r\n\t\t\t\t}\r\n\t\t\t\tif(newVal !== 'text') {\r\n\t\t\t\t\tuni.hideKeyboard()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods:{\r\n\t\t\t...mapMutations([\r\n\t\t\t\t'regSendVoiceEvent'\r\n\t\t\t]),\r\n\t\t\tinit(){\r\n\t\t\t\tlet total = 20\r\n\t\t\t\tlet page = Math.ceil(total/8)\r\n\t\t\t\tvar arr = []\r\n\t\t\t\tfor (var i = 0; i < page; i++) {\r\n\t\t\t\t\tlet start = i*8\r\n\t\t\t\t\tarr[i] = []\r\n\t\t\t\t\tfor (var j = 1; j <= 8; j++) {\r\n\t\t\t\t\t\tlet no = start + j\r\n\t\t\t\t\t\tif(no > 20) continue;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tarr[i].push({\r\n\t\t\t\t\t\t\tname:\"表情\" + no,\r\n\t\t\t\t\t\t\ticon:\"/static/images/extends/pic.png\",\r\n\t\t\t\t\t\t\tevent:\"sendEmoticon\"\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.emoticonList = arr\r\n\t\t\t},\r\n\t\t\topenChatSet(){\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: '../../chat-set/chat-set?params='+JSON.stringify({\r\n\t\t\t\t\t\tid:this.detail.id,\r\n\t\t\t\t\t\tchat_type:this.detail.chat_type\r\n\t\t\t\t\t}),\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tclickPage(){\r\n\t\t\t\tthis.mode = ''\r\n\t\t\t},\r\n\t\t\tclickInput() {\r\n\t\t\t\tthis.mode = 'text'\r\n\t\t\t},\r\n\t\t\tonInputFocus() {\r\n\t\t\t\tthis.mode = 'text'\r\n\t\t\t\t\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tthis.keyboardHeight = this.savekeyboardHeight\r\n\t\t\t\t}, 10)\r\n\t\t\t},\r\n\t\t\t// 打开扩展菜单或表情包\r\n\t\t\topenActionOrEmoticon(mode = 'action') {\r\n\t\t\t\tthis.mode = mode\r\n\t\t\t\tthis.$refs.action.show()\r\n\t\t\t\t\r\n\t\t\t\tuni.hideKeyboard()\r\n\t\t\t\tthis.keyboardHeight = uni.upx2px(580)\r\n\t\t\t\tthis.pageToBottom()\r\n\t\t\t},\r\n\t\t\t// 回到底部\r\n\t\t\tpageToBottom(){\r\n\t\t\t\t// #ifdef APP-PLUS-NVUE\r\n\t\t\t\tlet chatItem = this.$refs.chatItem\r\n\t\t\t\tlet lastIndex = chatItem.length > 0 ? chatItem.length - 1 : 0\r\n\t\t\t\t\r\n\t\t\t\tif(chatItem[lastIndex]){\r\n\t\t\t\t\tdom.scrollToElement(chatItem[lastIndex], {})\r\n\t\t\t\t}\r\n\t\t\t\t// #endif\r\n\t\t\t\t\r\n\t\t\t\t// #ifndef APP-PLUS-NVUE\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tlet lastIndex = this.list.length - 1\r\n\t\t\t\t\tthis.scrollIntoView = 'chatItem_' + lastIndex\r\n\t\t\t\t}, 300)\r\n\t\t\t\t// #endif\r\n\t\t\t},\r\n\t\t\t// 长按消息气泡\r\n\t\t\tlong({x,y,index}){\r\n\t\t\t\tthis.propIndex = index\r\n\t\t\t\tthis.$refs.extend.show(x,y)\r\n\t\t\t},\r\n\t\t\tclickEvent(event){\r\n\t\t\t\tswitch (event) {\r\n\t\t\t\t\tcase 'removeChatItem':\r\n\t\t\t\t\t\tif(this.propIndex > -1) {\r\n\t\t\t\t\t\t\tthis.list[this.propIndex].isremove = true\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tthis.$refs.extend.hide()\r\n\t\t\t},\r\n\t\t\tsend(type, data = '', options){\r\n\t\t\t\t// 组织数据格式\r\n\t\t\t\tswitch(type){\r\n\t\t\t\t\tcase 'text':\r\n\t\t\t\t\t\tdata = this.text\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tlet message = this.chat.formatSendData({\r\n\t\t\t\t\ttype,\r\n\t\t\t\t\tdata,\r\n\t\t\t\t\toptions\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\t// 渲染到页面\r\n\t\t\t\tlet index = this.list.length\r\n\t\t\t\tthis.list.push(message)\r\n\t\t\t\t\r\n\t\t\t\t// 监听上传进度\r\n\t\t\t\tlet onProgress = false\r\n\t\t\t\tif((message.type !== 'text' && message.type !== 'emoticon' && message.type !== 'card' && !message.data.startsWith('http://tangzhe123-com'))){\r\n\t\t\t\t\tonProgress = (progress) => {\r\n\t\t\t\t\t\tconsole.log('上传进度', progress);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// 发送到服务器\r\n\t\t\t\tthis.chat.send(message, onProgress).then(res => {\r\n\t\t\t\t\tthis.list[index].id = res.id\r\n\t\t\t\t\tthis.list[index].sendStatus = 'success'\r\n\t\t\t\t}).catch(err => {\r\n\t\t\t\t\tthis.list[index].sendStatus = 'fail'\r\n\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\tif(type === 'text'){\r\n\t\t\t\t\tthis.text = ''\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.pageToBottom()\r\n\t\t\t},\r\n\t\t\t// 扩展菜单事件\r\n\t\t\tactionEvent(e) {\r\n\t\t\t\tswitch (e.event) {\r\n\t\t\t\t\tcase 'uploadImage': \r\n\t\t\t\t\t\t// 发送到服务器\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t// 渲染到页面\r\n\t\t\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\t\t\tcount:9,\r\n\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\tres.tempFilePaths.forEach(item => {\r\n\t\t\t\t\t\t\t\t\tthis.send('image', item)\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'sendEmoticon':\r\n\t\t\t\t\t\tthis.send('emoticon', e.icon)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'uploadVideo':\r\n\t\t\t\t\t\tuni.chooseVideo({\r\n\t\t\t\t\t\t\tmaxDuration: 10,\r\n\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\t// 发送服务器\r\n\t\t\t\t\t\t\t\tconsole.log(66666666666, res.tempFilePath);\r\n\t\t\t\t\t\t\t\tthis.send('video', res.tempFilePath, {\r\n\t\t\t\t\t\t\t\t\tposter: ''\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t// 渲染到页面\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tpreviewImage(url){\r\n\t\t\t\tuni.previewImage({\r\n\t\t\t\t\tcurrent: url,\r\n\t\t\t\t\turls: this.imageList,\r\n\t\t\t\t\tindicator: 'default'\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tchangeVoiceOrText(){\r\n\t\t\t\tthis.mode = this.mode !== 'audio' ? 'audio' : 'text'\r\n\t\t\t},\r\n\t\t\tvoiceTouchStart(e){\r\n\t\t\t\tthis.isRecording = true\r\n\t\t\t\tthis.unRecord = false\r\n\t\t\t\tthis.recordingStartY = e.changedTouches[0].screenY\r\n\t\t\t\t\r\n\t\t\t\t// 开始录音\r\n\t\t\t\tthis.RECORD.start({\r\n\t\t\t\t\tformat: 'mp3'\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tvoiceTouchMove(e){\r\n\t\t\t\tlet y = Math.abs(e.changedTouches[0].screenY - this.recordingStartY)\r\n\t\t\t\tthis.unRecord = y > 80\r\n\t\t\t},\r\n\t\t\tvoiceTouchEnd(){\r\n\t\t\t\tthis.isRecording = false\r\n\t\t\t\t\r\n\t\t\t\t// 停止录音\r\n\t\t\t\tthis.RECORD.stop()\r\n\t\t\t},\r\n\t\t\tvoiceTouchCancel(){\r\n\t\t\t\tthis.isRecording = false\r\n\t\t\t\tthis.unRecord = true\r\n\t\t\t\t\r\n\t\t\t\t// 停止录音\r\n\t\t\t\tthis.RECORD.stop()\r\n\t\t\t}\r\n\t\t}\n\t}\n</script>\n\n<style>\n\n</style>"],"sourceRoot":""}